---
import { PUBLIC_STRAPI_URL } from '../lib/conections';

const { titulo } = Astro.props;

// 1. PETICIÓN (Usamos fetch directo para asegurar que Strapi traiga las imágenes)
const response = await fetch(`${PUBLIC_STRAPI_URL}/destactados?populate[destacados][populate]=image`);
const json = await response.json();

// 2. EXTRACCIÓN SIMPLE
const data = Array.isArray(json.data) ? json.data[0] : json.data;
// Sacamos la lista de productos que está dentro
const productos = data?.destacados || [];
const tituloMostrar = titulo || data?.titulo || "Productos Destacados";
---

<section class="py-12 px-6 max-w-7xl mx-auto">
    <h2 class="text-3xl font-bold mb-8 uppercase border-b pb-4">
        {tituloMostrar}
    </h2>

    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        {productos.map((item: any) => (
                <article class="border rounded-lg bg-white overflow-hidden hover:shadow-lg transition-shadow">
                    <a href={`/producto/${item.slug}`}>

                        <div class="h-56 p-4 flex justify-center items-center bg-gray-50">
                            <img
                                    src={item.image?.url}
                                    alt={item.nombre}
                                    class="h-full w-full object-contain mix-blend-multiply"
                            />
                        </div>

                        <div class="p-4 text-center border-t border-gray-100">
                            <h3 class="font-semibold text-gray-900 mb-2 truncate">{item.nombre}</h3>
                            <p class="text-xl font-bold text-blue-600">
                                $ {Number(item.precio).toLocaleString('es-CL')}
                            </p>
                        </div>
                    </a>
                </article>
        ))}
    </div>
</section>